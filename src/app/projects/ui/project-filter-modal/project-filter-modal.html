@if (isOpen) {
  <div class="fixed inset-0 z-50 flex items-center justify-center">
    <!-- backdrop -->
    <button
      type="button"
      class="fixed inset-0 bg-black/40 backdrop-blur-sm"
      (click)="close.emit()"
      aria-label="Close"
    ></button>

    <!-- modal -->
    <div
      class="relative z-10 max-w-lg w-full mx-4 bg-white dark:bg-slate-900 rounded-3xl shadow-2xl p-6 md:p-8 border-2 border-slate-100 dark:border-slate-700"
    >
      <div class="flex justify-between items-center mb-8">
        <h3 class="font-bold text-slate-800 dark:text-white text-xl">Filtres</h3>

        <button
          type="button"
          class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-500"
          (click)="close.emit()"
        >
          ✕
        </button>
      </div>

      <div class="space-y-8">
        <!-- Progress -->
        <div>
          <p class="text-xs font-bold text-slate-400 uppercase mb-3 tracking-wider">
            Progression (%)
          </p>

          <div class="flex gap-3 items-center">
            <label class="flex-1 text-sm font-medium text-slate-600 dark:text-slate-300">
              Min
              <input
                class="mt-1 w-full px-4 py-3 rounded-2xl border-2 border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 dark:text-white outline-none focus:border-blue-500"
                type="number"
                min="0"
                max="100"
                [(ngModel)]="localProgressMin"
              />
            </label>

            <label class="flex-1 text-sm font-medium text-slate-600 dark:text-slate-300">
              Max
              <input
                class="mt-1 w-full px-4 py-3 rounded-2xl border-2 border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 dark:text-white outline-none focus:border-blue-500"
                type="number"
                min="0"
                max="100"
                [(ngModel)]="localProgressMax"
              />
            </label>
          </div>

          <p class="text-[11px] text-slate-400 mt-2">
            (Min/Max seront normalisés à l’application)
          </p>
        </div>

        <!-- Deadline -->
        <div>
          <p class="text-xs font-bold text-slate-400 uppercase mb-3 tracking-wider">
            Date limite
          </p>

          <div class="flex gap-3">
            @for (f of dateFilterOptions; track f) {
              <button
                type="button"
                class="flex-1 py-3 rounded-xl border-2 font-bold text-xs transition-all"
                [ngClass]="localDateFilters.includes(f)
                  ? 'bg-blue-50 border-blue-500 text-blue-600 dark:bg-blue-900/20'
                  : 'bg-slate-50 dark:bg-slate-800 border-transparent text-slate-500'"
                (click)="toggleDateFilter(f)"
              >
                {{ f }}
              </button>
            }
          </div>
        </div>

        <!-- People -->
        <div>
          <p class="text-xs font-bold text-slate-400 uppercase mb-3 tracking-wider">
            Membres de l'équipe
          </p>

          <div class="space-y-2">
            @for (u of users; track u.id) {
              <label
                class="flex items-center gap-3 px-4 py-3 rounded-2xl border-2 border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 cursor-pointer"
              >
                <input
                  type="checkbox"
                  class="accent-blue-600"
                  [checked]="localSelectedPeople.includes(u.id)"
                  (change)="togglePerson(u.id)"
                />
                <span class="font-bold text-slate-700 dark:text-slate-200">{{ u.label }}</span>
              </label>
            }
          </div>
        </div>
      </div>

      <div class="mt-10 pt-6 border-t border-slate-100 dark:border-slate-700 flex gap-3">
        <button
          type="button"
          class="flex-1 py-4 rounded-2xl border-2 border-slate-200 dark:border-slate-700 font-bold text-slate-600 dark:text-slate-300"
          (click)="close.emit()"
        >
          Annuler
        </button>

        <button
          type="button"
          class="flex-1 py-4 bg-blue-600 text-white font-bold rounded-2xl hover:bg-blue-700 shadow-xl shadow-blue-500/20 active:scale-95 transition-all"
          (click)="onApply(); close.emit()"
        >
          Valider
        </button>
      </div>
    </div>
  </div>
}
