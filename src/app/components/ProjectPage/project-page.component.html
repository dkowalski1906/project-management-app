<div class="project-page" *ngIf="project">
  <header class="project-header">
    <div class="header-nav">
      <button class="btn-back" (click)="navigateBack()">â† Retour</button>
    </div>

    <div class="header-content">
      <div class="left-panel">
        <div class="title-row">
          <h1>{{ project.name }}</h1>
          <span class="deadline-badge">ğŸ“… Deadline : {{ project.deadline }}</span>
        </div>
        <p class="description">{{ project.description }}</p>

        <div class="progress-section">
          <div class="progress-bar-container">
            <div class="progress-fill" [style.width.%]="project.progress"></div>
          </div>
          <span class="progress-percent">{{ project.progress }}%</span>
        </div>

        <div class="action-buttons">
          <button class="btn-primary">+ Nouvelle tÃ¢che</button>
          <button class="btn-secondary" (click)="openAddColumnModal()">ğŸ“‹ Nouvelle colonne</button>
        </div>
      </div>

      <div class="right-panel">
        <div class="stat-group">
          <span class="label">PARTICIPANTS</span>
          <div class="member-list">
            @for (member of project.members; track member) {
              <div class="avatar">{{ member[0] }}</div>
            }
          </div>
        </div>

        <div class="stat-group">
          <span class="label">RÃ‰SUMÃ‰</span>
          <div class="summary-card">
            @for (col of project.columns; track col.id) {
              <div class="summary-item">
                <span class="count">{{ col.tasks.length }}</span>
                <span class="dot" [style.background-color]="col.color"></span>
                @if(col.isLastOne) { <small title="Colonne finale">ğŸ†</small> }
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="kanban-board" 
      cdkDropList 
      cdkDropListOrientation="horizontal" 
      [cdkDropListData]="project.columns"
      (cdkDropListDropped)="dropColumn($event)"> @for (column of project.columns; track column.id; let i = $index) {
        <div class="column" cdkDrag> <h3 class="column-header" cdkDragHandle> <span class="dot" [style.background-color]="column.color"></span>
            {{ column.name }}
            <span class="badge">{{ column.tasks.length }}</span>
          </h3>

          <div class="drop-list"
              [id]="column.id"
              cdkDropList
              [cdkDropListData]="column.tasks"
              [cdkDropListConnectedTo]="getConnectedLists()"
              (cdkDropListDropped)="dropTask($event, column)"> @for (task of column.tasks; track task.id) {
              <div class="task-card" cdkDrag> <p class="task-name" (click)="openTask(task)">{{ task.title }}</p>
                <div class="card-footer">
                  <span class="assignee">ğŸ‘¤ {{ task.assignedTo }}</span>
                  <span class="due-date">ğŸ“… {{ task.deadline }}</span>
                </div>
              </div>
            }
          </div>
        </div>
      }
  </main>

  @if (showColumnModal) {
    <div class="modal-overlay">
      <div class="modal-card">
        <h3>Nouvelle Colonne</h3>
        <input type="text" [(ngModel)]="newColName" placeholder="Nom (ex: TerminÃ©, Archive...)">
        
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="newColIsLast">
          DÃ©finir comme colonne finale
        </label>

        <div class="modal-actions">
          <button (click)="closeModal()">Annuler</button>
          <button class="btn-confirm" (click)="confirmAddColumn()">CrÃ©er</button>
        </div>
      </div>
    </div>
  }
</div>